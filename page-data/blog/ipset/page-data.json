{"componentChunkName":"component---src-templates-markdown-post-js","path":"/blog/ipset","result":{"data":{"markdownRemark":{"html":"<h1>해외 접속</h1>\n<p>서비스를 운영하다보면, 종종 특정 국가에서만 접속을 허용하거나, 특정 국가에서 접속하지 못하도록 화이트리스트/블랙리스트를 구성해야 하는 경우가 있습니다.\n이러한 <code class=\"language-text\">ipset</code>을 이용하여 이런 목록들을 구성하고, <code class=\"language-text\">iptables</code>을 이용하여 해당 목록으로 접속을 차단하거나 허용하도록 규칙을 추가해보았습니다.</p>\n<h2>ipset 설치</h2>\n<p>먼저 리스트를 구성하기 위해 패키지 관리자를 통해 ipset을 설치합니다.</p>\n<h3>CentOS</h3>\n<div class=\"gatsby-highlight\" data-language=\"/bin/bash\"><pre class=\"language-/bin/bash\"><code class=\"language-/bin/bash\">yum install ipset -y</code></pre></div>\n<h3>Ubuntu</h3>\n<div class=\"gatsby-highlight\" data-language=\"/bin/bash\"><pre class=\"language-/bin/bash\"><code class=\"language-/bin/bash\">apt-get install ipset -y</code></pre></div>\n<h2>IP 목록 다운로드</h2>\n<p>필요한 IP CIDR 목록 파일을 다운로드 받습니다.\n아래는 한국 IP에서만 접속을 허용하기 위해 작성된 목록입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"/bin/bash\"><pre class=\"language-/bin/bash\"><code class=\"language-/bin/bash\">curl https://ludorum.keybase.pub/ipset/kr.zone -o kr.zone</code></pre></div>\n<ul>\n<li><a href=\"https://www.ipdeny.com/ipblocks/\">IPDeny</a></li>\n<li><a href=\"https://ludorum.keybase.pub/ipset/kr.zone\">한국 IP목록</a></li>\n</ul>\n<h2>ipset 설정</h2>\n<p>ipset을 생성하고 ip대역을 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"/bin/bash\"><pre class=\"language-/bin/bash\"><code class=\"language-/bin/bash\">ipset -N kr hash:net\nfor a in $(cat kr.zone); do ipset -A kr $a; done</code></pre></div>\n<p>추가된 목록을 확인합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"/bin/bash\"><pre class=\"language-/bin/bash\"><code class=\"language-/bin/bash\">ipset list | less</code></pre></div>\n<h2>iptables 설정하기</h2>\n<p>아래 예시를 참고하여 iptable을 설정합니다.</p>\n<h3>예시) 허용된 KR IP외에 모든 IP에서 80, 443포트 차단하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"/bin/bash\"><pre class=\"language-/bin/bash\"><code class=\"language-/bin/bash\">iptables -A INPUT -p tcp -m set --match-set kr src --dport 80 -j ACCEPT\niptables -A INPUT -p tcp -m set --match-set kr src --dport 443 -j ACCEPT\niptables -A INPUT -p tcp --dport 443 -j DROP\niptables -A INPUT -p tcp --dport 80 -j DROP</code></pre></div>","frontmatter":{"date":"May 22, 2020","slug":"/blog/ipset","title":"ipset을 사용하여 iptables에 국가 필터링하기"}}},"pageContext":{"slug":"/blog/ipset"}}}